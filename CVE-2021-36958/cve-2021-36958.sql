-- Rule for seeking indicators of CVE-2021-36958 exploitation
-- 
-- 
-- tested on osquery 4.9.0

select SUBSTR(first.path, 118) as path,first.data as module from registry first join registry second
    where
    first.key like 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\Providers\Client Side Rendering Print Provider\Servers\%\Printers\%\CopyFiles\%' and
    second.key like 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\Providers\Client Side Rendering Print Provider\Servers\%\Printers\%\CopyFiles\%' and
    first.name = 'Module' and
    second.name = 'Files' and
    first.data = second.data
;