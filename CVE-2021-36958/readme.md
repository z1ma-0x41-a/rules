# CVE-2021-36958

Derived the analysis of exploitation activity can highlight the following events points to this one:

* During the connection process of "Pick and Print" driver occurs querying of driver keys ( RPC EnumPrinterKey ).
Further when key "CopyFile" is found retrieve key data happens ( RPC EnumPrinterDataEx ) and among responses observes values 'Files' that contains DLL file name and 'TargerDir' contains 'X64\3' ( for x64 ) or 'W32X86\3' ( for x86 ).

* Observing a key "CopyFiles" with value "Module" equals to value "File" from any previous one

* Keys and values used during the process can be observed on a client in registry at "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\Providers\Client Side Rendering Print Provider\Servers\...\Printers\...\CopyFiles\"

As @gentilkiwi noticed [1] mechanism of attack is similar to "old printnightmare with DataFile and ConfigFile"

Attacker can upload ( and even replace existing one in "\Windows\System32\spool\drivers\" ) needed dll via value 'Files' of CopyFile directive and load via value 'Module'

### References:

[1] https://twitter.com/gentilkiwi/status/1416429860566847490

[2] https://www.kb.cert.org/vuls/id/131152
